!function(e){"function"==typeof define&&define.amd?define("userBar",e):e()}(function(){"use strict";window.render_notifications=()=>{Array.from(document.querySelectorAll(".ts-notifications-wrapper")).forEach(t=>{if(!t.__vue_app__){let e=JSON.parse(t.dataset.config);var o=Vue.createApp({el:t,template:t.innerHTML,mixins:[Voxel.mixins.base],data(){return{active:!1,screen:"main",list:null,hasMore:!1,loading:!0,loadingMore:!1,page:1,activeItem:null}},methods:{open(){null===this.list&&(this.list=[],this.$refs.indicator?.classList.add("hidden"),this.getList()),this.active=!0},getList(){this.loadingMore=!0,jQuery.get(Voxel_Config.ajax_url+"&action=notifications.list",{pg:this.page}).always(e=>{e.success?(this.list.push(...e.list),this.hasMore=e.has_more):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error"),this.loading=!1,this.loadingMore=!1})},loadMore(){this.page++,this.getList()},clearAll(){confirm(e.l10n.confirmClear)&&jQuery.get(Voxel_Config.ajax_url+"&action=notifications.clear_all").always(e=>{e.success?this.list=[]:Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},goBack(){this.activeItem=null,requestAnimationFrame(()=>this.$refs.top.closest(".min-scroll").scrollTop=this._scrollPosition)},openItem(t){"(details)"===t.links_to?(this._scrollPosition=this.$refs.top.closest(".min-scroll").scrollTop,void 0===t.actions?(t.seen=!0,this.loadActions(t)):(this.activeItem=t,requestAnimationFrame(()=>this.$refs.top.closest(".min-scroll").scrollTop=0))):(t._loading=!0,jQuery.get(Voxel_Config.ajax_url+"&action=notifications.open",{item_id:t.id}).always(e=>{e.success?(t.seen=!0,e.redirect_to&&(window.location.href=e.redirect_to)):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error"),t._loading=!1}))},loadActions(t,e=1){t.actions_page=e,t._loading=!0,jQuery.get(Voxel_Config.ajax_url+"&action=notifications.get_actions",{item_id:t.id,pg:e}).always(e=>{e.success?(void 0===t.actions?t.actions=e.actions:t.actions.push(...e.actions),1===(this.activeItem=t).actions_page&&requestAnimationFrame(()=>this.$refs.top.closest(".min-scroll").scrollTop=0)):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error"),t._loading=!1,t.seen=!0})},doItemAction(o,s,e){if(e?.key)var t=e.key;else{if(!s.key)return;t=s.key}s._loading=!0,jQuery.get(Voxel_Config.ajax_url+"&action=notifications.run_action",{item_id:o.id,action_key:t,pg:s._page}).always(e=>{var t;e.success?(e.updated_action&&-1!==(t=o.actions.indexOf(s))&&(o.actions[t]=e.updated_action),e.redirect_to&&(window.location.href=e.redirect_to)):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error"),s._loading=!1})}}});o.component("form-popup",Voxel.components.popup),o.component("form-group",Voxel.components.formGroup),o.mount(t)}})},window.render_notifications(),jQuery(document).on("voxel:markup-update",window.render_notifications),window.render_popup_messages=()=>{Array.from(document.querySelectorAll(".ts-popup-messages")).forEach(t=>{if(!t.__vue_app__){let e=JSON.parse(t.dataset.config);var o=Vue.createApp({el:t,template:t.innerHTML,mixins:[Voxel.mixins.base],data(){return{active:!1,chats:{list:null,hasMore:!1,loading:!0,loadingMore:!1,page:1}}},methods:{open(){this.active=!0,null===this.chats.list&&(this.chats.list=[],this.$refs.indicator?.classList.add("hidden"),this.getChats())},getChats(){this.chats.loadingMore=!0,jQuery.get(Voxel_Config.ajax_url+"&action=inbox.list_chats",{pg:this.chats.page,_wpnonce:e.nonce}).always(e=>{e.success?(this.chats.list.push(...e.list),this.chats.hasMore=e.has_more):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error"),this.chats.loading=!1,this.chats.loadingMore=!1})},loadMoreChats(){this.chats.page++,this.getChats()}}});o.component("form-popup",Voxel.components.popup),o.mount(t)}})},window.render_popup_messages(),jQuery(document).on("voxel:markup-update",window.render_popup_messages),window.render_voxel_cart=()=>{Array.from(document.querySelectorAll(".ts-popup-cart")).forEach(t=>{if(!t.__vue_app__){let s=JSON.parse(t.dataset.config),e=Voxel_Config.is_logged_in;var o=Vue.createApp({el:t,template:t.innerHTML,mixins:[Voxel.mixins.base],data(){return{active:!1,loading:!0,loaded:!1,items:null,checkout_link:"",disabled:!1}},created(){window.VX_Cart=this,jQuery(document).on("voxel:added_cart_item",(e,t)=>{this.getItems(),this.$refs.icon.classList.add("ts-cart-update"),setTimeout(()=>this.$refs.icon.classList.remove("ts-cart-update"),500)})},methods:{open(){var e=document.querySelector(".ts-checkout");e?Voxel.scrollTo(e):(this.active=!0,null===this.items&&(this.items={},this.getItems()))},getItems(){e?jQuery.post(Voxel_Config.ajax_url+"&action=products.get_cart_items",{_wpnonce:s.nonce,guest_cart:localStorage.getItem("voxel:guest_cart")}).always(e=>{this.loading=!1,this.loaded=!0,localStorage.removeItem("voxel:guest_cart"),e.success?(this.items=Object.keys(e.items).length?e.items:{},this.checkout_link=e.checkout_link):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")}):jQuery.post(Voxel_Config.ajax_url+"&action=products.get_guest_cart_items",{_wpnonce:s.nonce,guest_cart:localStorage.getItem("voxel:guest_cart")}).always(e=>{this.loading=!1,this.loaded=!0,e.success?(this.items=Object.keys(e.items).length?e.items:{},this.checkout_link=e.checkout_link,this.storeGuestCart()):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},removeItem(t){e?(t._disabled=!0,jQuery.post(Voxel_Config.ajax_url+"&action=products.remove_cart_item",{item_key:t.key,_wpnonce:s.nonce}).always(e=>{e.success?delete this.items[t.key]:(t._disabled=!1,Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error"))})):(delete this.items[t.key],this.storeGuestCart())},emptyCart(){e?(this.disabled=!0,jQuery.post(Voxel_Config.ajax_url+"&action=products.empty_cart",{_wpnonce:s.nonce}).always(e=>{this.disabled=!1,e.success?this.items={}:Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})):(this.items={},localStorage.removeItem("voxel:guest_cart"))},_setQuantity(t,e){t._disabled=!0;var o=Voxel_Config.is_logged_in?"products.update_cart_item_quantity":"products.update_guest_cart_item_quantity";jQuery.post(Voxel_Config.ajax_url+"&action="+o,{item_key:t.key,item_quantity:e,guest_cart:Voxel_Config.is_logged_in?null:localStorage.getItem("voxel:guest_cart"),_wpnonce:s.nonce}).always(e=>{t._disabled=!1,e.success?(this.items[t.key]=e.item,Voxel_Config.is_logged_in||this.storeGuestCart()):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},getItemQuantity(e){return"regular"===e.product_mode?e.value.stock.quantity:"variable"===e.product_mode?e.value.variations.quantity:null},plusOne(e){var t=this.getItemQuantity(e)+1;this._setQuantity(e,t)},minusOne(e){var t=this.getItemQuantity(e)-1;t<=0?this.removeItem(e):this._setQuantity(e,t)},hasStockLeft(e){let t=e.quantity.max;for(var o of Object.values(this.items))if(o.stock_id===e.stock_id&&(t-=this.getItemQuantity(o))<=0)return!1;return!0},hasItems(){return!1===this.loading&&Object.keys(this.items).length},currencyFormat(){return Voxel.helpers.currencyFormat(...arguments)},getSubtotal(){if(!this.hasItems())return 0;let t=0;return Object.values(this.items).forEach(e=>{t+=e.pricing.total_amount}),t},storeGuestCart(){if(Object.keys(this.items).length){let t={};Object.values(this.items).forEach(e=>t[e.key]=e.value),localStorage.setItem("voxel:guest_cart",JSON.stringify(t))}else localStorage.removeItem("voxel:guest_cart")}},computed:{showIndicator(){return this.loaded?this.hasItems():Voxel_Config.is_logged_in?!s.is_cart_empty:!!localStorage.getItem("voxel:guest_cart")}}});o.component("form-popup",Voxel.components.popup),o.mount(t)}})},window.render_voxel_cart(),jQuery(document).on("voxel:markup-update",window.render_voxel_cart)});
