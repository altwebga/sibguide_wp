!function(e){"function"==typeof define&&define.amd?define("productTypeEditor",e):e()}(function(){"use strict";var i={template:"#pte-product-fields",components:{fieldModal:{template:"#pte-product-field-modal",props:{field:Object},methods:{save(){this.$parent.activeField=null}}}},data(){return{activeField:null}},methods:{toggleActive(e){return this.activeField=e===this.activeField?null:e},dragStart(){this.$refs["fields-container"].classList.add("drag-active")},dragEnd(){this.$refs["fields-container"].classList.remove("drag-active")}},computed:{has_fields(){for(var e of this.$root.product_fields)if(this.$root.evaluate_conditions(e.conditions))return!0;return!1}}},s={template:"#product-type-field-modal-template",props:["field"],mounted(){this.field.__first_edit&&this.$refs.keyInput.enable()},methods:{save(){this.$parent.active=null,delete this.field.__first_edit}}},o={template:"#product-type-rate-list-template",props:["modelValue","mode","source","dynamic"],data(){return{loading:!1,open:!1,rates:null,first_item:null,is_last_page:!1}},methods:{show(){this.open=!0,this.loading=!0,null===this.rates&&jQuery.get(Voxel_Config.ajax_url,{action:this.source,mode:this.mode,dynamic:this.dynamic},e=>{this.loading=!1,this.is_last_page=!e.has_more,this.rates=e.rates,this.first_item=this.rates?.[0]?.id})},toggle(e){var t=this.modelValue.indexOf(e.id);-1<t?this.modelValue.splice(t,1):this.modelValue.push(e.id)},isSelected(e){return-1<this.modelValue.indexOf(e.id)},remove(e){e=this.modelValue.indexOf(e);-1<e&&this.modelValue.splice(e,1)},prev(){this.loading=!0;var e=this.rates[0].id;jQuery.get(Voxel_Config.ajax_url,{action:this.source,mode:this.mode,ending_before:e},e=>{this.loading=!1,this.has_more=e.has_more,e.rates.length&&(this.rates=e.rates,this.is_last_page=!1)})},next(){this.loading=!0;var e=this.rates[this.rates.length-1].id;jQuery.get(Voxel_Config.ajax_url,{action:this.source,mode:this.mode,starting_after:e},e=>{this.loading=!1,this.has_more=e.has_more,e.rates.length&&(this.rates=e.rates,this.is_last_page=!e.has_more)})}}},a={template:`
		<div class="ts-icon-picker ts-icon-picker-vue">
			<div class="icon-preview" v-html="previewMarkup" @click.prevent="openLibrary" :title="modelValue"></div>

				<a href="#" @click.prevent="uploadSVG" class="ts-button ts-outline">Upload SVG</a>
				<a v-if="allowFonticons !== false" href="#" @click.prevent="openLibrary" class="ts-button ts-outline">Choose Icon</a>
				<a v-if="modelValue" href="#" @click.prevent="clear" class="ts-button ts-outline icon-only"><i class="lar la-trash-alt icon-sm"></i></a>

		</div>
	`,props:["modelValue","allowFonticons"],data(){return{previewMarkup:""}},created(){this.preview(this.modelValue)},methods:{preview(e){Voxel_Icon_Picker.getIconPreview(e,e=>this.previewMarkup=e)},openLibrary(){Voxel_Icon_Picker.edit(this.modelValue,e=>{this.setValue(e.library+":"+e.value)})},uploadSVG(){Voxel_Icon_Picker.getSVG(e=>{this.setValue("svg:"+e.id)})},clear(){this.setValue("")},setValue(e){this.preview(e),this.$emit("update:modelValue",e)}}},d={template:"#post-type-select-field-choices",props:{field:Object},data(){return{active:null}},methods:{add(){var e={value:"",label:"",icon:""};this.field.choices.push(e),this.active=e},remove(t){this.field.choices=this.field.choices.filter(e=>e!==t)},dragStart(){this.$refs["fields-container"].classList.add("drag-active")},dragEnd(){this.$refs["fields-container"].classList.remove("drag-active")}}},e={template:"#pte-addons-choices",props:{addon:Object,models:Array},components:{addonChoice:{template:"#pte-addons-choice",props:{parent:Object,choice:Object}}},created(){this.addon.choices||(this.addon.choices=[]),Array.isArray(this.addon.choices)||(this.addon.choices=Object.values(this.addon.choices))},methods:{add(){let t={};this.models.forEach(e=>{t[e.key]=""}),t.__autovalue=!0,this.addon.choices.push(t),this.$nextTick(()=>{var e=this.addon.choices.indexOf(t);this.$refs["choice:"+e]?.$refs["model:label"]?.[0]?.focus()})},remove(t){this.addon.choices=this.addon.choices.filter(e=>e!==t)},dragStart(){this.$refs["fields-container"].classList.add("drag-active")},dragEnd(){this.$refs["fields-container"].classList.remove("drag-active")}}},e={template:"#pte-addon-modal",props:{addon:Object},components:{addonChoices:e},mounted(){this.addon.__first_edit&&this.$refs.keyInput.enable()},methods:{save(){this.$parent.active=null,delete this.addon.__first_edit},updateAddonType(e){["custom-select","custom-multiselect"].includes(this.addon.type)&&["select","multiselect"].includes(e)?(this.addon.type=e,Array.isArray(this.addon.choices)||(this.addon.choices=[]),"cards"!==this.addon.display_mode&&"images"!==this.addon.display_mode||(this.addon.display_mode="dropdown")):["select","multiselect"].includes(this.addon.type)&&["custom-select","custom-multiselect"].includes(e)&&(this.addon.type=e)}}},n={template:"#pte-addons-module",props:{config:Object},components:{addonModal:e},data(){return{active:null,active_category:"vendor-defined"}},methods:{toggleActive(e){return this.active=e===this.active?null:e},createAddon(e){e=$.extend(!0,{},e.props);let t=1;var i=e.type+"-addon";let s=i;for(;this.getAddonByKey(s);)t++,s=i+"-"+t;e.key=s,this.config.items.push(e)},getAddonByKey(t){return this.config.items.find(e=>e.key===t)},deleteAddon(t){this.config.items=this.config.items.filter(e=>e!==t)},dragStart(){this.$refs["fields-container"].classList.add("drag-active")},dragEnd(){this.$refs["fields-container"].classList.remove("drag-active")}}},e={template:"#pte-attribute-choices",props:{attribute:Object,models:Array},components:{attributeChoice:{template:"#pte-attribute-choice",props:{parent:Object,choice:Object}}},methods:{add(){let t={};this.models.forEach(e=>{t[e.key]=""}),t.__autovalue=!0,this.attribute.choices.push(t),this.$nextTick(()=>{var e=this.attribute.choices.indexOf(t);this.$refs["choice:"+e]?.$refs["model:label"]?.[0]?.focus()})},remove(t){this.attribute.choices=this.attribute.choices.filter(e=>e!==t)},dragStart(){this.$refs["fields-container"].classList.add("drag-active")},dragEnd(){this.$refs["fields-container"].classList.remove("drag-active")}}},e={template:"#pte-attribute-modal",props:{attribute:Object},components:{attributeChoices:e},mounted(){this.attribute.__first_edit&&this.$refs.keyInput.enable()},methods:{save(){this.$parent.active=null,delete this.attribute.__first_edit}}},r={template:"#pte-variations-module",props:{config:Object},components:{attributeModal:e},data(){return{active:null,active_category:"vendor-defined"}},methods:{toggleActive(e){return this.active=e===this.active?null:e},createAttribute(e,t){var i=$.extend(!0,{},this.$root.options.product_attributes.predefined);let s=1;var o=e;let a=o;for(;this.getAttributeByKey(a);)s++,a=o+"-"+s;i.key=a,i.display_mode=e,i.label=t,this.config.attributes.push(i)},getAttributeByKey(t){return this.config.attributes.find(e=>e.key===t)},deleteAttribute(t){this.config.attributes=this.config.attributes.filter(e=>e!==t)},dragStart(){this.$refs["fields-container"].classList.add("drag-active")},dragEnd(){this.$refs["fields-container"].classList.remove("drag-active")}}},e={template:"#pte-data-input-modal",props:{dataInput:Object},components:{dataInputSelectChoices:{template:"#pte-data-input-select-choices",props:{dataInput:Object},data(){return{active:null}},methods:{add(){var e={value:null,label:null};this.dataInput.choices.push(e),this.active=e,this.$nextTick(()=>this.$refs.choiceLabel?.focus?.())}}}},mounted(){this.dataInput.__first_edit&&this.$refs.keyInput.enable()},methods:{save(){this.$parent.active=null,delete this.dataInput.__first_edit}}},c={template:"#pte-data-inputs-module",props:{config:Object},components:{dataInputModal:e},data(){return{active:null}},methods:{toggleActive(e){return this.active=e===this.active?null:e},createDataInput(e){e=jQuery.extend(!0,{},e.props);let t=1;var i=e.type;let s=i;for(;this.getDataInputByKey(s);)t++,s=i+"-"+t;e.key=s,e.__first_edit=!0,this.config.items.push(e)},getDataInputByKey(t){return this.config.items.find(e=>e.key===t)},deleteDataInput(t){this.config.items=this.config.items.filter(e=>e!==t)}}};jQuery(e=>{var t;document.getElementById("voxel-edit-product-type")&&(window.$=jQuery,(t=Vue.createApp({data(){return{tab:"general",subtab:"mode",config:Product_Type_Config,submit_config:"",options:Product_Type_Options,product_fields:Object.values(Product_Type_Options.product_fields)}},created(){var e;window.PTE=this,window.location.hash&&(e=window.location.hash.replace("#","").split("."),this.setTab(e[0],e[1]))},methods:{setTab(e,t=""){this.tab=e,this.subtab=t,window.location.hash=this.config.tab=t?e+"."+t:e},prepareSubmission(e){this.config.settings.product_fields={};for(var t of this.product_fields)this.evaluate_conditions(t.conditions)&&(this.config.settings.product_fields[t.props.key]=t.props);this.submit_config=JSON.stringify(this.config)},evaluate_conditions(e){if("object"==typeof e)for(var t in e){var i=Voxel_Backend.pathAccess(this.config,t),t=e[t];if("object"==typeof t)if("equals"===t.compare){if(i!==t.value)return!1}else if("not_equals"===t.compare){if(i===t.value)return!1}else{if("in_array"!==t.compare)return!1;if(!t.value.includes(i))return!1}else if(i!==t)return!1}return!0},isModuleAvailable(e){return!("cart"===e.module_key&&"payment"!==this.config.settings.payments.mode||"shipping"===e.module_key&&!["payment"].includes(this.config.settings.payments.mode))&&(e.product_mode["*"]||e.product_mode[this.config.settings.product_mode])},isModuleRequired(e){let t="required"===e.product_mode["*"]||"required"===e.product_mode[this.config.settings.product_mode];return t="base_price"===e.module_key&&["regular","booking"].includes(this.config.settings.product_mode)&&this.config.modules.addons.enabled?!1:t},shouldListModule(e){return!("base_price"===e.module_key&&["regular","booking"].includes(this.config.settings.product_mode)||"cart"===e.module_key&&"payment"!==this.config.settings.payments.mode||"shipping"===e.module_key&&!["payment"].includes(this.config.settings.payments.mode))}},watch:{"config.settings.product_mode"(e){Object.keys(this.config.modules).forEach(e=>{var t=this.options.modules[e];this.isModuleRequired(t)&&(this.config.modules[e].enabled=!0)}),"subscription"===this.config.settings.payments.mode&&"regular"!==e&&(this.config.settings.payments.mode="payment")}}})).component("field-key",Voxel_Backend.components.Field_Key),t.component("color-picker",Voxel_Backend.components.Color_Picker),t.component("draggable",vuedraggable),t.component("field-modal",s),t.component("icon-picker",a),t.component("rate-list",o),t.component("select-field-choices",d),t.component("product-fields",i),t.component("addons-module",n),t.component("variations-module",r),t.component("base-price-module",{template:"#pte-base-price-module",props:{config:Object}}),t.component("booking-module",{template:"#pte-booking-module",props:{config:Object}}),t.component("stock-module",{template:"#pte-stock-module",props:{config:Object}}),t.component("shipping-module",{template:"#pte-shipping-module",props:{config:Object}}),t.component("cart-module",{template:"#pte-cart-module",props:{config:Object}}),t.component("deliverables-module",{template:"#pte-deliverables-module",props:{config:Object}}),t.component("offline-payments-module",{template:"#pte-offline-payments-module",props:{config:Object}}),t.component("data-inputs-module",c),t.mount("#voxel-edit-product-type"))})});
