!function(e){"function"==typeof define&&define.amd?define("collections",e):e()}(function(){"use strict";window.render_collections=()=>{Array.from(document.querySelectorAll(".ts-collections")).forEach(t=>{if(!t.__vue_app__){let e=t.dataset.postId,s=t.parentElement,i=s.dataset.tooltipDefault,o=s.dataset.tooltipActive;var a=Vue.createApp({el:t,template:t.innerHTML,mixins:[Voxel.mixins.base],data(){return{active:!1,screen:"main",items:{list:null,hasMore:!1,loading:!0,loadingMore:!1,page:1},toggling:!1,create:{loading:!1,title:""},saveOnCreate:!1}},created(){jQuery(document).on("voxel:collection-created",(e,t)=>{null!==this.items.list&&(t=jQuery.extend(!0,{},t),this.items.list.push(t),this.saveOnCreate)&&(this.saveOnCreate=!1,this.toggleItem(t))})},mounted(){this.$refs.target.classList.contains("active")&&o?s.dataset.tooltip=o:i&&(s.dataset.tooltip=i)},methods:{open(){if(!Voxel_Config.is_logged_in)return Voxel.authRequired();null===this.items.list&&(this.items.list=[],this.getList()),this.active=!0},getList(){this.items.loadingMore=!0,jQuery.get(Voxel_Config.ajax_url+"&action=user.collections.list",{post_id:e,pg:this.items.page}).always(e=>{e.success?(this.items.list.push(...e.list),this.items.hasMore=e.has_more):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error"),this.items.loading=!1,this.items.loadingMore=!1,this.$nextTick(()=>this.$refs.popup?.reposition())})},loadMore(){this.items.page++,this.getList()},showCreateScreen(){this.screen="create",requestAnimationFrame(()=>this.$refs.input?.focus())},createCollection(){this.create.loading=!0,jQuery.post(Voxel_Config.ajax_url+"&action=user.collections.create",{title:this.create.title}).always(e=>{e.success?(this.saveOnCreate=!0,jQuery(document).trigger("voxel:collection-created",e.item)):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error"),this.create.loading=!1})},toggleItem(t){this.toggling=!0,this.create.loading=!0,jQuery.post(Voxel_Config.ajax_url+"&action=user.collections.toggle_item",{collection_id:t.id,post_id:e,toggle:t.selected?"remove":"add"}).always(e=>{e.success?(t.selected="added"===e.status,t.selected&&(this.$refs.popup.$emit("blur"),Voxel.alert(e.message,"success",e.actions))):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error"),this.screen="main",this.create.title="",this.toggling=!1,this.create.loading=!1,e.is_saved?(this.$refs.target.classList.add("active"),o?s.dataset.tooltip=o:delete s.dataset.tooltip):(this.$refs.target.classList.remove("active"),i?s.dataset.tooltip=i:delete s.dataset.tooltip)})}}});a.component("popup",Voxel.components.popup),a.mount(t)}})},window.render_collections(),jQuery(document).on("voxel:markup-update",window.render_collections)});
